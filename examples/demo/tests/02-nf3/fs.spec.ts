import path from "node:path";
import glob from "fast-glob";
import { assert, describe, it } from "vitest";

describe("fs", () => {
  const expected = [
    "/config.json",
    "/functions/api_isr_1w7em5.func/.vc-config.json",
    "/functions/api_isr_1w7em5.func/index.mjs",
    "/functions/api_isr_1w7em5.prerender-config.json",
    "/functions/api_page_1gngr9.func/.vc-config.json",
    "/functions/api_page_1gngr9.func/index.mjs",
    "/functions/name_[name]_vl2chm.func/.vc-config.json",
    "/functions/name_[name]_vl2chm.func/index.mjs",
    "/functions/named_[someId]_cfm46n.func/.vc-config.json",
    "/functions/named_[someId]_cfm46n.func/index.mjs",
    "/functions/named_[someId]_cfm46n.func/node_modules/react-dom/cjs/react-dom-server-legacy.node.development.js",
    "/functions/named_[someId]_cfm46n.func/node_modules/react-dom/cjs/react-dom-server-legacy.node.production.js",
    "/functions/named_[someId]_cfm46n.func/node_modules/react-dom/cjs/react-dom-server.node.development.js",
    "/functions/named_[someId]_cfm46n.func/node_modules/react-dom/cjs/react-dom-server.node.production.js",
    "/functions/named_[someId]_cfm46n.func/node_modules/react-dom/cjs/react-dom.development.js",
    "/functions/named_[someId]_cfm46n.func/node_modules/react-dom/cjs/react-dom.production.js",
    "/functions/named_[someId]_cfm46n.func/node_modules/react-dom/index.js",
    "/functions/named_[someId]_cfm46n.func/node_modules/react-dom/package.json",
    "/functions/named_[someId]_cfm46n.func/node_modules/react-dom/server.node.js",
    "/functions/named_[someId]_cfm46n.func/node_modules/react/cjs/react-jsx-runtime.development.js",
    "/functions/named_[someId]_cfm46n.func/node_modules/react/cjs/react-jsx-runtime.production.js",
    "/functions/named_[someId]_cfm46n.func/node_modules/react/cjs/react.development.js",
    "/functions/named_[someId]_cfm46n.func/node_modules/react/cjs/react.production.js",
    "/functions/named_[someId]_cfm46n.func/node_modules/react/index.js",
    "/functions/named_[someId]_cfm46n.func/node_modules/react/jsx-runtime.js",
    "/functions/named_[someId]_cfm46n.func/node_modules/react/package.json",
    "/functions/routes_[---catchall]_96lu7c.func/.vc-config.json",
    "/functions/routes_[---catchall]_96lu7c.func/index.mjs",
    "/functions/routes_[---catchall]_96lu7c.func/node_modules/react-dom/cjs/react-dom-server-legacy.node.development.js",
    "/functions/routes_[---catchall]_96lu7c.func/node_modules/react-dom/cjs/react-dom-server-legacy.node.production.js",
    "/functions/routes_[---catchall]_96lu7c.func/node_modules/react-dom/cjs/react-dom-server.node.development.js",
    "/functions/routes_[---catchall]_96lu7c.func/node_modules/react-dom/cjs/react-dom-server.node.production.js",
    "/functions/routes_[---catchall]_96lu7c.func/node_modules/react-dom/cjs/react-dom.development.js",
    "/functions/routes_[---catchall]_96lu7c.func/node_modules/react-dom/cjs/react-dom.production.js",
    "/functions/routes_[---catchall]_96lu7c.func/node_modules/react-dom/index.js",
    "/functions/routes_[---catchall]_96lu7c.func/node_modules/react-dom/package.json",
    "/functions/routes_[---catchall]_96lu7c.func/node_modules/react-dom/server.node.js",
    "/functions/routes_[---catchall]_96lu7c.func/node_modules/react/cjs/react-jsx-runtime.development.js",
    "/functions/routes_[---catchall]_96lu7c.func/node_modules/react/cjs/react-jsx-runtime.production.js",
    "/functions/routes_[---catchall]_96lu7c.func/node_modules/react/cjs/react.development.js",
    "/functions/routes_[---catchall]_96lu7c.func/node_modules/react/cjs/react.production.js",
    "/functions/routes_[---catchall]_96lu7c.func/node_modules/react/index.js",
    "/functions/routes_[---catchall]_96lu7c.func/node_modules/react/jsx-runtime.js",
    "/functions/routes_[---catchall]_96lu7c.func/node_modules/react/package.json",
    "/functions/routes_[---catchall]_96lu7c.prerender-config.json",
    "/functions/routes_dynamic_1j4abj.func/.vc-config.json",
    "/functions/routes_dynamic_1j4abj.func/index.mjs",
    "/functions/routes_dynamic_1j4abj.func/node_modules/react-dom/cjs/react-dom-server-legacy.node.development.js",
    "/functions/routes_dynamic_1j4abj.func/node_modules/react-dom/cjs/react-dom-server-legacy.node.production.js",
    "/functions/routes_dynamic_1j4abj.func/node_modules/react-dom/cjs/react-dom-server.node.development.js",
    "/functions/routes_dynamic_1j4abj.func/node_modules/react-dom/cjs/react-dom-server.node.production.js",
    "/functions/routes_dynamic_1j4abj.func/node_modules/react-dom/cjs/react-dom.development.js",
    "/functions/routes_dynamic_1j4abj.func/node_modules/react-dom/cjs/react-dom.production.js",
    "/functions/routes_dynamic_1j4abj.func/node_modules/react-dom/index.js",
    "/functions/routes_dynamic_1j4abj.func/node_modules/react-dom/package.json",
    "/functions/routes_dynamic_1j4abj.func/node_modules/react-dom/server.node.js",
    "/functions/routes_dynamic_1j4abj.func/node_modules/react/cjs/react-jsx-runtime.development.js",
    "/functions/routes_dynamic_1j4abj.func/node_modules/react/cjs/react-jsx-runtime.production.js",
    "/functions/routes_dynamic_1j4abj.func/node_modules/react/cjs/react.development.js",
    "/functions/routes_dynamic_1j4abj.func/node_modules/react/cjs/react.production.js",
    "/functions/routes_dynamic_1j4abj.func/node_modules/react/index.js",
    "/functions/routes_dynamic_1j4abj.func/node_modules/react/jsx-runtime.js",
    "/functions/routes_dynamic_1j4abj.func/node_modules/react/package.json",
    "/functions/routes_edge_1bx41y.func/.vc-config.json",
    "/functions/routes_edge_1bx41y.func/index.js",
    "/functions/routes_edge_1bx41y.func/node_modules/react-dom/cjs/react-dom-server-legacy.browser.development.js",
    "/functions/routes_edge_1bx41y.func/node_modules/react-dom/cjs/react-dom-server-legacy.browser.production.js",
    "/functions/routes_edge_1bx41y.func/node_modules/react-dom/cjs/react-dom-server.edge.development.js",
    "/functions/routes_edge_1bx41y.func/node_modules/react-dom/cjs/react-dom-server.edge.production.js",
    "/functions/routes_edge_1bx41y.func/node_modules/react-dom/cjs/react-dom.development.js",
    "/functions/routes_edge_1bx41y.func/node_modules/react-dom/cjs/react-dom.production.js",
    "/functions/routes_edge_1bx41y.func/node_modules/react-dom/index.js",
    "/functions/routes_edge_1bx41y.func/node_modules/react-dom/package.json",
    "/functions/routes_edge_1bx41y.func/node_modules/react-dom/server.edge.js",
    "/functions/routes_edge_1bx41y.func/node_modules/react/cjs/react-jsx-runtime.development.js",
    "/functions/routes_edge_1bx41y.func/node_modules/react/cjs/react-jsx-runtime.production.js",
    "/functions/routes_edge_1bx41y.func/node_modules/react/cjs/react.development.js",
    "/functions/routes_edge_1bx41y.func/node_modules/react/cjs/react.production.js",
    "/functions/routes_edge_1bx41y.func/node_modules/react/index.js",
    "/functions/routes_edge_1bx41y.func/node_modules/react/jsx-runtime.js",
    "/functions/routes_edge_1bx41y.func/node_modules/react/package.json",
    "/functions/routes_index_1afnff.func/.vc-config.json",
    "/functions/routes_index_1afnff.func/index.mjs",
    "/functions/routes_index_1afnff.func/node_modules/react-dom/cjs/react-dom-server-legacy.node.development.js",
    "/functions/routes_index_1afnff.func/node_modules/react-dom/cjs/react-dom-server-legacy.node.production.js",
    "/functions/routes_index_1afnff.func/node_modules/react-dom/cjs/react-dom-server.node.development.js",
    "/functions/routes_index_1afnff.func/node_modules/react-dom/cjs/react-dom-server.node.production.js",
    "/functions/routes_index_1afnff.func/node_modules/react-dom/cjs/react-dom.development.js",
    "/functions/routes_index_1afnff.func/node_modules/react-dom/cjs/react-dom.production.js",
    "/functions/routes_index_1afnff.func/node_modules/react-dom/index.js",
    "/functions/routes_index_1afnff.func/node_modules/react-dom/package.json",
    "/functions/routes_index_1afnff.func/node_modules/react-dom/server.node.js",
    "/functions/routes_index_1afnff.func/node_modules/react/cjs/react-jsx-runtime.development.js",
    "/functions/routes_index_1afnff.func/node_modules/react/cjs/react-jsx-runtime.production.js",
    "/functions/routes_index_1afnff.func/node_modules/react/cjs/react.development.js",
    "/functions/routes_index_1afnff.func/node_modules/react/cjs/react.production.js",
    "/functions/routes_index_1afnff.func/node_modules/react/index.js",
    "/functions/routes_index_1afnff.func/node_modules/react/jsx-runtime.js",
    "/functions/routes_index_1afnff.func/node_modules/react/package.json",
    "/functions/routes_isr_1ndvja.func/.vc-config.json",
    "/functions/routes_isr_1ndvja.func/index.mjs",
    "/functions/routes_isr_1ndvja.func/node_modules/react-dom/cjs/react-dom-server-legacy.node.development.js",
    "/functions/routes_isr_1ndvja.func/node_modules/react-dom/cjs/react-dom-server-legacy.node.production.js",
    "/functions/routes_isr_1ndvja.func/node_modules/react-dom/cjs/react-dom-server.node.development.js",
    "/functions/routes_isr_1ndvja.func/node_modules/react-dom/cjs/react-dom-server.node.production.js",
    "/functions/routes_isr_1ndvja.func/node_modules/react-dom/cjs/react-dom.development.js",
    "/functions/routes_isr_1ndvja.func/node_modules/react-dom/cjs/react-dom.production.js",
    "/functions/routes_isr_1ndvja.func/node_modules/react-dom/index.js",
    "/functions/routes_isr_1ndvja.func/node_modules/react-dom/package.json",
    "/functions/routes_isr_1ndvja.func/node_modules/react-dom/server.node.js",
    "/functions/routes_isr_1ndvja.func/node_modules/react/cjs/react-jsx-runtime.development.js",
    "/functions/routes_isr_1ndvja.func/node_modules/react/cjs/react-jsx-runtime.production.js",
    "/functions/routes_isr_1ndvja.func/node_modules/react/cjs/react.development.js",
    "/functions/routes_isr_1ndvja.func/node_modules/react/cjs/react.production.js",
    "/functions/routes_isr_1ndvja.func/node_modules/react/index.js",
    "/functions/routes_isr_1ndvja.func/node_modules/react/jsx-runtime.js",
    "/functions/routes_isr_1ndvja.func/node_modules/react/package.json",
    "/functions/routes_isr_1ndvja.prerender-config.json",
    "/functions/routes_og-edge_u8dtyy.func/.vc-config.json",
    "/functions/routes_og-edge_u8dtyy.func/index.js",
    "/functions/routes_og-edge_u8dtyy.func/node_modules/@vercel/og/dist/index.edge.js",
    "/functions/routes_og-edge_u8dtyy.func/node_modules/@vercel/og/dist/noto-sans-v27-latin-regular.ttf",
    "/functions/routes_og-edge_u8dtyy.func/node_modules/@vercel/og/dist/resvg.wasm",
    "/functions/routes_og-edge_u8dtyy.func/node_modules/@vercel/og/dist/yoga.wasm",
    "/functions/routes_og-edge_u8dtyy.func/node_modules/@vercel/og/package.json",
    "/functions/routes_og-edge_u8dtyy.func/node_modules/react/cjs/react-jsx-runtime.development.js",
    "/functions/routes_og-edge_u8dtyy.func/node_modules/react/cjs/react-jsx-runtime.production.js",
    "/functions/routes_og-edge_u8dtyy.func/node_modules/react/cjs/react.development.js",
    "/functions/routes_og-edge_u8dtyy.func/node_modules/react/cjs/react.production.js",
    "/functions/routes_og-edge_u8dtyy.func/node_modules/react/index.js",
    "/functions/routes_og-edge_u8dtyy.func/node_modules/react/jsx-runtime.js",
    "/functions/routes_og-edge_u8dtyy.func/node_modules/react/package.json",
    "/functions/routes_og-node_sewegp.func/.vc-config.json",
    "/functions/routes_og-node_sewegp.func/index.mjs",
    "/functions/routes_og-node_sewegp.func/node_modules/@vercel/og/dist/index.node.js",
    "/functions/routes_og-node_sewegp.func/node_modules/@vercel/og/dist/noto-sans-v27-latin-regular.ttf",
    "/functions/routes_og-node_sewegp.func/node_modules/@vercel/og/dist/resvg.wasm",
    "/functions/routes_og-node_sewegp.func/node_modules/@vercel/og/dist/yoga.wasm",
    "/functions/routes_og-node_sewegp.func/node_modules/@vercel/og/package.json",
    "/functions/routes_og-node_sewegp.func/node_modules/react/cjs/react-jsx-runtime.development.js",
    "/functions/routes_og-node_sewegp.func/node_modules/react/cjs/react-jsx-runtime.production.js",
    "/functions/routes_og-node_sewegp.func/node_modules/react/cjs/react.development.js",
    "/functions/routes_og-node_sewegp.func/node_modules/react/cjs/react.production.js",
    "/functions/routes_og-node_sewegp.func/node_modules/react/index.js",
    "/functions/routes_og-node_sewegp.func/node_modules/react/jsx-runtime.js",
    "/functions/routes_og-node_sewegp.func/node_modules/react/package.json",
    "/static/vite.svg",
  ];

  it("should generate the right files", async () => {
    const dir = path.join(__dirname, "../../.vercel/output");
    const entries = await glob(`${dir}/**`, { dot: true });
    let mappedEntries = entries.map((e) => e.replace(dir, "")).filter((e) => !e.startsWith("/_ignore"));

    mappedEntries = Array.from(new Set(mappedEntries));

    assert.sameMembers(mappedEntries.sort(), expected.sort());
  });
});
